<tool id="lightcurve_analysis_astro_tool" name="lightcurve-analysis" version="0.0.1+galaxy0" profile="23.0">
  <requirements>
    <requirement type="package" version="6.0.0">astropy</requirement>
    <requirement type="package" version="3.8.3">matplotlib</requirement>
    <requirement type="package" version="1.2.12">oda-api</requirement>
    <!--Requirements string 'nb2workflow' can't be converted automatically. Please add the galaxy/conda requirement manually or modify the requirements file!-->
  </requirements>
  <command detect_errors="exit_code">python '$__tool_directory__/${_data_product._selector}.py'</command>
  <configfiles>
    <inputs name="inputs" filename="inputs.json" data_style="paths" />
  </configfiles>
  <inputs>
    <conditional name="_data_product">
      <param name="_selector" type="select" label="Data Product">
        <option value="correlate" selected="true">correlate</option>
        <option value="detect_impulsive" selected="false">detect_impulsive</option>
      </param>
      <when value="correlate">
        <param name="light_curve_1" type="data" label="light_curve_1" data-format="data" />
        <param name="light_curve_2" type="data" label="light_curve_2" data-format="data" />
        <param name="mode" type="select" label="mode">
          <option value="Background" selected="true">Background</option>
          <option value="Focus">Focus</option>
          <option value="Peak">Peak</option>
        </param>
      </when>
      <when value="detect_impulsive">
        <param name="light_curve" type="data" label="light_curve" data-format="data" />
        <param name="time_column" type="text" value="TIME" label="time_column" />
        <param name="rate_column" type="text" value="FLUX" label="rate_column" />
        <param name="rate_err_column" type="text" value="FLUX_ERR" label="rate_err_column" />
        <param name="mode" type="select" label="mode">
          <option value="Background" selected="true">Background</option>
          <option value="Focus">Focus</option>
          <option value="Peak">Peak</option>
          <option value="Standartize">Standartize</option>
        </param>
      </when>
    </conditional>
  </inputs>
  <outputs>
    <data label="${tool.name} -&gt; correlate detection_image" name="out_correlate_detection_image" format="auto" from_work_dir="detection_image_galaxy.output">
      <filter>_data_product['_selector'] == 'correlate'</filter>
    </data>
    <data label="${tool.name} -&gt; correlate processed_lc" name="out_correlate_processed_lc" format="auto" from_work_dir="processed_lc_galaxy.output">
      <filter>_data_product['_selector'] == 'correlate'</filter>
    </data>
    <data label="${tool.name} -&gt; detect_impulsive detection_image" name="out_detect_impulsive_detection_image" format="auto" from_work_dir="detection_image_galaxy.output">
      <filter>_data_product['_selector'] == 'detect_impulsive'</filter>
    </data>
    <data label="${tool.name} -&gt; detect_impulsive processed_lc" name="out_detect_impulsive_processed_lc" format="auto" from_work_dir="processed_lc_galaxy.output">
      <filter>_data_product['_selector'] == 'detect_impulsive'</filter>
    </data>
  </outputs>
  <tests>
    <test expect_num_outputs="2">
      <conditional name="_data_product">
        <param name="_selector" value="correlate" />
        <param name="light_curve_1" location="https://gitlab.renkulab.io/astronomy/mmoda/lightcurve-analysis/-/raw/79ac0083817eb87ef0be9e71ac7a77df5dc7214a/spiacs_lc_query.fits" />
        <param name="light_curve_2" location="https://gitlab.renkulab.io/astronomy/mmoda/lightcurve-analysis/-/raw/79ac0083817eb87ef0be9e71ac7a77df5dc7214a/spiacs_lc_query.fits" />
        <param name="mode" value="Background" />
      </conditional>
      <assert_stdout>
        <has_text text="*** Job finished successfully ***" />
      </assert_stdout>
    </test>
    <test expect_num_outputs="2">
      <conditional name="_data_product">
        <param name="_selector" value="detect_impulsive" />
        <param name="light_curve" location="https://gitlab.renkulab.io/astronomy/mmoda/lightcurve-analysis/-/raw/79ac0083817eb87ef0be9e71ac7a77df5dc7214a/spiacs_lc_query.fits" />
        <param name="time_column" value="TIME" />
        <param name="rate_column" value="FLUX" />
        <param name="rate_err_column" value="FLUX_ERR" />
        <param name="mode" value="Background" />
      </conditional>
      <assert_stdout>
        <has_text text="*** Job finished successfully ***" />
      </assert_stdout>
    </test>
  </tests>
</tool>