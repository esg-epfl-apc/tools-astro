<tool id="tabular_data_manipulation_astro_tool" name="Tabular Data Manipulation" version="0.0.1+galaxy0" profile="23.0">
  <requirements>
    <requirement type="package" version="2.2.2">pandas</requirement>
    <requirement type="package" version="1.2.26">oda-api</requirement>
    <requirement type="package" version="3.9.2">matplotlib</requirement>
    <requirement type="package" version="6.1.2">astropy</requirement>
  </requirements>
  <command detect_errors="exit_code">python '$__tool_directory__/${_data_product._selector}.py'</command>
  <configfiles>
    <inputs name="inputs" filename="inputs.json" data_style="paths" />
  </configfiles>
  <inputs>
    <conditional name="_data_product">
      <param name="_selector" type="select" label="Data Product">
        <option value="merge_tables" selected="true">merge_tables</option>
        <option value="histogram_column" selected="false">histogram_column</option>
        <option value="compute_new_column" selected="false">compute_new_column</option>
      </param>
      <when value="merge_tables">
        <param name="fn1" type="data" label="fn1" format="data" />
        <param name="fn2" type="data" label="fn2" format="data" />
        <param name="new_column" type="text" value="sum" label="new_column" />
        <param name="sep" type="select" label="sep">
          <option value="auto" selected="true">auto</option>
          <option value="comma">comma</option>
          <option value="tab">tab</option>
        </param>
      </when>
      <when value="histogram_column">
        <param name="fn" type="data" label="fn" format="data" />
        <param name="sep" type="select" label="sep">
          <option value="auto" selected="true">auto</option>
          <option value="comma">comma</option>
          <option value="tab">tab</option>
        </param>
        <param name="column" type="text" value="c0" label="column" />
        <param name="weights" type="text" value="c1" label="weights" />
        <param name="binning" type="select" label="binning">
          <option value="linear">linear</option>
          <option value="logarithmic" selected="true">logarithmic</option>
        </param>
        <param name="minval" type="float" value="10000000000.0" label="minval" />
        <param name="maxval" type="float" value="10000000000000.0" label="maxval" />
        <param name="nbins" type="integer" value="15" label="nbins" />
        <param name="xlabel" type="text" value="Energy, eV" label="xlabel" />
        <param name="ylabel" type="text" value="Ncounts" label="ylabel" />
      </when>
      <when value="compute_new_column">
        <param name="fn" type="data" label="fn" format="data" />
        <param name="new_column" type="text" value="sum" label="new_column" />
        <param name="expression" type="text" value="c1 __gt__ (c2 + v0 - v1)" label="expression" />
        <param name="variables" type="text" value="1 2" label="variables" />
        <param name="sep" type="select" label="sep">
          <option value="auto" selected="true">auto</option>
          <option value="comma">comma</option>
          <option value="tab">tab</option>
        </param>
        <param name="action" type="select" label="action">
          <option value="add" selected="true">add</option>
          <option value="filter">filter</option>
        </param>
      </when>
    </conditional>
  </inputs>
  <outputs>
    <data label="${tool.name} -&gt; merge_tables outputfile" name="out_merge_tables_outputfile" format="auto" from_work_dir="outputfile_galaxy.output">
      <filter>_data_product['_selector'] == 'merge_tables'</filter>
    </data>
    <data label="${tool.name} -&gt; histogram_column histogram_data" name="out_histogram_column_histogram_data" format="auto" from_work_dir="histogram_data_galaxy.output">
      <filter>_data_product['_selector'] == 'histogram_column'</filter>
    </data>
    <data label="${tool.name} -&gt; histogram_column histogram_picture" name="out_histogram_column_histogram_picture" format="auto" from_work_dir="histogram_picture_galaxy.output">
      <filter>_data_product['_selector'] == 'histogram_column'</filter>
    </data>
    <data label="${tool.name} -&gt; compute_new_column outputfile" name="out_compute_new_column_outputfile" format="auto" from_work_dir="outputfile_galaxy.output">
      <filter>_data_product['_selector'] == 'compute_new_column'</filter>
    </data>
  </outputs>
  <tests>
    <test expect_num_outputs="1">
      <conditional name="_data_product">
        <param name="_selector" value="merge_tables" />
        <param name="fn1" location="https://gitlab.renkulab.io/astronomy/mmoda/tabular-data-manipulation/-/raw/a07ab391d48c7eedf18b414c33f8f92e56522d86/testfile.tsv" />
        <param name="fn2" location="https://gitlab.renkulab.io/astronomy/mmoda/tabular-data-manipulation/-/raw/a07ab391d48c7eedf18b414c33f8f92e56522d86/testfile.tsv" />
        <param name="new_column" value="sum" />
        <param name="sep" value="auto" />
      </conditional>
      <assert_stdout>
        <has_text text="*** Job finished successfully ***" />
      </assert_stdout>
    </test>
    <test expect_num_outputs="2">
      <conditional name="_data_product">
        <param name="_selector" value="histogram_column" />
        <param name="fn" location="https://gitlab.renkulab.io/astronomy/mmoda/tabular-data-manipulation/-/raw/a07ab391d48c7eedf18b414c33f8f92e56522d86/testfile.tsv" />
        <param name="sep" value="auto" />
        <param name="column" value="c0" />
        <param name="weights" value="c1" />
        <param name="binning" value="logarithmic" />
        <param name="minval" value="10000000000.0" />
        <param name="maxval" value="10000000000000.0" />
        <param name="nbins" value="15" />
        <param name="xlabel" value="Energy, eV" />
        <param name="ylabel" value="Ncounts" />
      </conditional>
      <assert_stdout>
        <has_text text="*** Job finished successfully ***" />
      </assert_stdout>
    </test>
    <test expect_num_outputs="1">
      <conditional name="_data_product">
        <param name="_selector" value="compute_new_column" />
        <param name="fn" location="https://gitlab.renkulab.io/astronomy/mmoda/tabular-data-manipulation/-/raw/a07ab391d48c7eedf18b414c33f8f92e56522d86/testfile.tsv" />
        <param name="new_column" value="sum" />
        <param name="expression" value="c1 __gt__ (c2 + v0 - v1)" />
        <param name="variables" value="1 2" />
        <param name="sep" value="auto" />
        <param name="action" value="add" />
      </conditional>
      <assert_stdout>
        <has_text text="*** Job finished successfully ***" />
      </assert_stdout>
    </test>
  </tests>
</tool>