<tool id="grb_detection_astro_tool" name="GRB detection" version="0.0.1+galaxy0" profile="24.0">
  <requirements>
    <requirement type="package" version="9.2.0">ipython</requirement>
    <requirement type="package" version="7.0.1">astropy</requirement>
    <requirement type="package" version="3.10.1">matplotlib</requirement>
    <requirement type="package" version="1.2.27">oda-api</requirement>
    <requirement type="package" version="2.2.5">numpy</requirement>
    <!--Requirements string 'renku-aqs>=1.0.4
' can't be converted automatically. Please add the galaxy/conda requirement manually or modify the requirements file!-->
    <requirement type="package" version="7.16.6">nbconvert</requirement>
    <requirement type="package" version="5.10.4">nbformat</requirement>
    <requirement type="package" version="0.3.3">gcn-kafka</requirement>
    <requirement type="package" version="0.14.2">xmltodict</requirement>
    <requirement type="package" version="0.11.0">hop-client</requirement>
    <!--Requirements string 'integral-client
' can't be converted automatically. Please add the galaxy/conda requirement manually or modify the requirements file!-->
    <!--Requirements string 'isdc-client
' can't be converted automatically. Please add the galaxy/conda requirement manually or modify the requirements file!-->
    <!--Requirements string 'astropy_healpix
' can't be converted automatically. Please add the galaxy/conda requirement manually or modify the requirements file!-->
    <!--Requirements string 'integral-visibility
' can't be converted automatically. Please add the galaxy/conda requirement manually or modify the requirements file!-->
    <requirement type="package" version="2.3.0">ligo.skymap</requirement>
    <!--Requirements string 'git+https://github.com/volodymyrss/oda-function.git
' can't be converted automatically. Please add the galaxy/conda requirement manually or modify the requirements file!-->
    <!--Requirements string 'matrix-client
' can't be converted automatically. Please add the galaxy/conda requirement manually or modify the requirements file!-->
  </requirements>
  <command detect_errors="exit_code">python '$__tool_directory__/${C_data_product_.DPselector_}.py'</command>
  <environment_variables>
    <environment_variable name="BASEDIR">$__tool_directory__</environment_variable>
    <environment_variable name="GALAXY_TOOL_DIR">$__tool_directory__</environment_variable>
  </environment_variables>
  <configfiles>
    <inputs name="inputs" filename="inputs.json" data_style="paths" />
  </configfiles>
  <inputs>
    <conditional name="C_data_product_">
      <param name="DPselector_" type="select" label="Data Product">
        <option value="detectgrb" selected="true">detectgrb</option>
        <option value="integralallsky" selected="false">integralallsky</option>
      </param>
      <when value="detectgrb">
        <param name="T1" type="text" value="2023-01-16T04:53:33.9" label="T1" optional="false" />
        <param name="T2" type="text" value="2023-01-16T04:55:33.9" label="T2" optional="false" />
        <param name="detection_time_scales" type="text" value="1,10" label="detection_time_scales" optional="false" />
        <param name="lc_time_scale" type="float" value="0.1" label="lc_time_scale" optional="false" />
        <param name="background_age" type="float" value="10" label="background_age (unit: s)" optional="false" />
        <param name="min_sn" type="integer" value="5" label="min_sn" optional="false" />
      </when>
      <when value="integralallsky">
        <param name="RA" type="float" value="293.732" label="RA" optional="false" />
        <param name="Dec" type="float" value="21.8967222" label="Dec" optional="false" />
        <param name="tstart_rel_mseconds" type="float" value="300.0" label="tstart_rel_mseconds" optional="false" />
        <param name="tstop_rel_seconds" type="float" value="300.0" label="tstop_rel_seconds" optional="false" />
        <param name="t0_utc" type="text" value="2023-06-27T01:53:37.000" label="t0_utc" optional="false" />
        <param name="required_completeness" type="float" value="0.3" label="required_completeness" optional="false" />
        <param name="mode" type="text" value="scw" label="mode" optional="false" />
        <param name="global_snr_threshold" type="float" value="3.0" label="global_snr_threshold" optional="false" />
        <param name="negative_excesses" type="integer" value="0" label="negative_excesses" optional="false" />
      </when>
    </conditional>
  </inputs>
  <outputs>
    <data label="${tool.name} -&gt; detectgrb lc" name="out_detectgrb_lc" format="auto" from_work_dir="lc_galaxy.output">
      <filter>C_data_product_['DPselector_'] == 'detectgrb'</filter>
    </data>
    <data label="${tool.name} -&gt; detectgrb detection_comment" name="out_detectgrb_detection_comment" format="auto" from_work_dir="detection_comment_galaxy.output">
      <filter>C_data_product_['DPselector_'] == 'detectgrb'</filter>
    </data>
    <data label="${tool.name} -&gt; detectgrb image_output" name="out_detectgrb_image_output" format="auto" from_work_dir="image_output_galaxy.output">
      <filter>C_data_product_['DPselector_'] == 'detectgrb'</filter>
    </data>
    <data label="${tool.name} -&gt; detectgrb image_fits" name="out_detectgrb_image_fits" format="auto" from_work_dir="image_fits_galaxy.output">
      <filter>C_data_product_['DPselector_'] == 'detectgrb'</filter>
    </data>
    <data label="${tool.name} -&gt; integralallsky acs_lc_png" name="out_integralallsky_acs_lc_png" format="auto" from_work_dir="acs_lc_png_galaxy.output">
      <filter>C_data_product_['DPselector_'] == 'integralallsky'</filter>
    </data>
    <data label="${tool.name} -&gt; integralallsky acs_rt_lc_png" name="out_integralallsky_acs_rt_lc_png" format="auto" from_work_dir="acs_rt_lc_png_galaxy.output">
      <filter>C_data_product_['DPselector_'] == 'integralallsky'</filter>
    </data>
    <data label="${tool.name} -&gt; integralallsky acs_rt_det_lc_png" name="out_integralallsky_acs_rt_det_lc_png" format="auto" from_work_dir="acs_rt_det_lc_png_galaxy.output">
      <filter>C_data_product_['DPselector_'] == 'integralallsky'</filter>
    </data>
    <data label="${tool.name} -&gt; integralallsky ibis_veto_lc_png" name="out_integralallsky_ibis_veto_lc_png" format="auto" from_work_dir="ibis_veto_lc_png_galaxy.output">
      <filter>C_data_product_['DPselector_'] == 'integralallsky'</filter>
    </data>
    <data label="${tool.name} -&gt; integralallsky excesses_mosaic_png" name="out_integralallsky_excesses_mosaic_png" format="auto" from_work_dir="excesses_mosaic_png_galaxy.output">
      <filter>C_data_product_['DPselector_'] == 'integralallsky'</filter>
    </data>
    <data label="${tool.name} -&gt; integralallsky summary" name="out_integralallsky_summary" format="auto" from_work_dir="summary_galaxy.output">
      <filter>C_data_product_['DPselector_'] == 'integralallsky'</filter>
    </data>
    <data label="${tool.name} -&gt; integralallsky reportable_excesses" name="out_integralallsky_reportable_excesses" format="auto" from_work_dir="reportable_excesses_galaxy.output">
      <filter>C_data_product_['DPselector_'] == 'integralallsky'</filter>
    </data>
    <data label="${tool.name} -&gt; integralallsky excvar_summary" name="out_integralallsky_excvar_summary" format="auto" from_work_dir="excvar_summary_galaxy.output">
      <filter>C_data_product_['DPselector_'] == 'integralallsky'</filter>
    </data>
  </outputs>
  <tests>
    <test expect_num_outputs="4">
      <conditional name="C_data_product_">
        <param name="DPselector_" value="detectgrb" />
        <param name="T1" value="2023-01-16T04:53:33.9" />
        <param name="T2" value="2023-01-16T04:55:33.9" />
        <param name="detection_time_scales" value="1,10" />
        <param name="lc_time_scale" value="0.1" />
        <param name="background_age" value="10" />
        <param name="min_sn" value="5" />
      </conditional>
      <assert_stdout>
        <has_text text="*** Job finished successfully ***" />
      </assert_stdout>
    </test>
    <test expect_num_outputs="8">
      <conditional name="C_data_product_">
        <param name="DPselector_" value="integralallsky" />
        <param name="RA" value="293.732" />
        <param name="Dec" value="21.8967222" />
        <param name="tstart_rel_mseconds" value="300.0" />
        <param name="tstop_rel_seconds" value="300.0" />
        <param name="t0_utc" value="2023-06-27T01:53:37.000" />
        <param name="required_completeness" value="0.3" />
        <param name="mode" value="scw" />
        <param name="global_snr_threshold" value="3.0" />
        <param name="negative_excesses" value="0" />
      </conditional>
      <assert_stdout>
        <has_text text="*** Job finished successfully ***" />
      </assert_stdout>
    </test>
  </tests>
</tool>