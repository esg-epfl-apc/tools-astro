<tool id="iact_simulators_astro_tool" name="IACT simulators" version="0.0.1+galaxy0" profile="23.0">
  <requirements>
    <requirement type="package" version="6.0">unzip</requirement>
    <requirement type="package" version="2.32.3">requests</requirement>
    <requirement type="package" version="1.15.1">scipy</requirement>
    <requirement type="package" version="1.21.4">wget</requirement>
    <requirement type="package" version="1.3">gammapy</requirement>
    <requirement type="package" version="3.9.4">matplotlib</requirement>
    <requirement type="package" version="1.2.35">oda-api</requirement>
    <requirement type="package" version="0.12.0">pyirf</requirement>
    <requirement type="package" version="0.10.1">astroplan</requirement>
    <requirement type="package" version="8.31.0">ipython</requirement>
    <requirement type="package" version="6.1.4">astropy</requirement>
    <requirement type="package" version="1.26.4">numpy</requirement>
    <requirement type="package" version="2.30.1">iminuit</requirement>
    <requirement type="package" version="0.70.17">multiprocess</requirement>
    <requirement type="package" version="7.16.5">nbconvert</requirement>
    <!--Requirements string 'nb2workflow[cwl,service,rdf,mmoda]>=1.3.30 
' can't be converted automatically. Please add the galaxy/conda requirement manually or modify the requirements file!-->
  </requirements>
  <command detect_errors="exit_code">ipython '$__tool_directory__/${_data_product._selector}.py'</command>
  <configfiles>
    <inputs name="inputs" filename="inputs.json" data_style="paths" />
  </configfiles>
  <inputs>
    <conditional name="_data_product">
      <param name="_selector" type="select" label="Data Product">
        <option value="CTAO" selected="true">CTAO</option>
        <option value="MAGIC_simulator-v1.9" selected="false">MAGIC_simulator-v1.9</option>
        <option value="LST1_spectrum" selected="false">LST1_spectrum</option>
        <option value="Visibility_predictor" selected="false">Visibility_predictor</option>
      </param>
      <when value="CTAO">
        <param name="RA" type="float" value="166.113809" label="RA (unit: deg)" />
        <param name="DEC" type="float" value="38.208833" label="DEC (unit: deg)" />
        <param name="OffAxis_angle" type="float" value="0.78" label="OffAxis_angle (unit: deg)" />
        <param name="Texp" type="float" value="1.0" label="Texp (unit: hour)" />
        <param name="z" type="float" value="0.03" label="z" />
        <param name="F0" type="float" value="1e-11" label="F0" />
        <param name="E0" type="float" value="1.0" label="E0 (unit: TeV)" />
        <param name="Gamma" type="float" value="2.0" label="Gamma" />
        <param name="Radius_spectal_extraction" type="float" value="0.2" label="Radius_spectal_extraction" />
        <param name="Radius_sky_image" type="float" value="2.5" label="Radius_sky_image (unit: deg)" />
        <param name="Site" type="select" label="Site">
          <option value="North" selected="true">North</option>
          <option value="South">South</option>
        </param>
        <param name="Telescope_LST" type="boolean" checked="true" label="Telescope_LST" />
        <param name="Telescope_MST" type="boolean" checked="true" label="Telescope_MST" />
        <param name="Telescope_SST" type="boolean" label="Telescope_SST" />
      </when>
      <when value="MAGIC_simulator-v1.9">
        <param name="src_name" type="text" value="Crab" label="src_name" />
        <param name="RA" type="float" value="83.6287" label="RA (unit: deg)" />
        <param name="DEC" type="float" value="22.0147" label="DEC (unit: deg)" />
        <param name="timeh" type="float" value="20" label="Observation time (unit: hour)" />
        <param name="extension" type="float" value="0.0" label="Source extension (unit: deg)" />
        <param name="redshift" type="float" value="0.13" label="Source redshift" />
        <param name="zenith" type="select" label="Zenith angle">
          <option value="hizd">hizd</option>
          <option value="lowzd" selected="true">lowzd</option>
          <option value="midzd">midzd</option>
        </param>
        <param name="isSUMT" type="boolean" label="Sum Trigger?" />
        <param name="numoff" type="integer" value="3" label="numoff" />
        <param name="minev" type="float" value="10.0" label="minimum number of events" />
        <param name="minSBR" type="float" value="0.05" label="minimum ratio of excess to background" />
        <param name="PSF" type="float" value="0.1" label="PSF (unit: deg)" />
        <param name="offsetdegrad" type="float" value="1.0" label="degradation factor (for offset &gt;0.4 deg)" />
        <param name="eplotmin" type="float" value="31" label="minimal energy (unit: GeV)" min="30.01" max="29999.0" />
        <param name="eplotmax" type="float" value="20000.0" label="maximal energy (unit: GeV)" min="30.01" max="29999.0" />
        <param name="yplotmin" type="float" value="1e-14" label="minimal flux [TeV/(cm2 s)]" />
        <param name="yplotmax" type="float" value="1e-09" label="maximal flux [TeV/(cm2 s)]" />
        <param name="minerror" type="float" value="2" label="Minimal errorbar (signal-to-noise)" />
        <param name="drawsigma" type="boolean" checked="true" label="drawsigma" />
        <param name="dN_dE" type="text" value="2.0e-11*pow(E/1000., -1.99)*exp(-E/1000)" label="Source spectrum dN/dE [1/(TeV cm2 s)]" />
        <param name="pulsar_mode" type="boolean" label="Pulsar analysis?" />
        <param name="on_phase_interval" type="float" value="0.092" label="range of ON phases" />
        <param name="off_phase_interval" type="float" value="0.25" label="range of OFF phases" />
        <param name="isLSTmode" type="boolean" label="isLSTmode" />
      </when>
      <when value="LST1_spectrum">
        <param name="src_name" type="text" value="Mrk 421" label="src_name" />
        <param name="RA" type="float" value="166.113809" label="RA (unit: deg)" />
        <param name="DEC" type="float" value="38.208833" label="DEC (unit: deg)" />
        <param name="T1" type="text" value="2022-10-09T13:16:00.0" label="T1" />
        <param name="T2" type="text" value="2022-10-10T13:16:00.0" label="T2" />
        <param name="redshift" type="float" value="0.13" label="Source redshift" />
        <param name="cut_efficiency" type="select" label="Gamma-hadron separation cut efficiency">
          <option value="0.4">0.4</option>
          <option value="0.7">0.7</option>
          <option value="0.9">0.9</option>
        </param>
        <param name="Zd" type="float" value="20.0" label="Zenith angle" />
        <param name="N_backgr_regions" type="integer" value="3" label="Number of backgorund regions" />
        <param name="Exposure_time" type="float" value="33.0" label="Exposure time in hours" />
        <param name="source_extension" type="float" value="0.1" label="Source extension in degrees" />
        <param name="dN_dE" type="text" value="2.0e-11*pow(E/1000., -1.99)*exp(-E/1000)" label="Source spectrum dN/dE [1/(TeV cm2 s)]" />
        <param name="pulsar_mode" type="boolean" label="Pulsar analysis?" />
        <param name="on_phase_interval" type="float" value="0.043" label="range of ON phases" />
        <param name="off_phase_interval" type="float" value="0.35" label="range of OFF phases" />
      </when>
      <when value="Visibility_predictor">
        <param name="src_name" type="text" value="Crab" label="src_name" />
        <param name="RA" type="float" value="83.6287" label="RA (unit: deg)" />
        <param name="DEC" type="float" value="22.0147" label="DEC (unit: deg)" />
        <param name="T1" type="text" value="2023-10-09T13:16:00.0" label="T1" />
        <param name="T2" type="text" value="2024-10-10T13:16:00.0" label="T2" />
        <param name="Zdmin" type="integer" value="0" label="Minimal zenith" />
        <param name="Zdmax" type="integer" value="30" label="Maximal zenith" />
        <param name="moon_max" type="float" value="0.1" label="maximal moon (between 0 and 1)" />
      </when>
    </conditional>
  </inputs>
  <outputs>
    <data label="${tool.name} -&gt; CTAO image_png" name="out_CTAO_image_png" format="auto" from_work_dir="image_png_galaxy.output">
      <filter>_data_product['_selector'] == 'CTAO'</filter>
    </data>
    <data label="${tool.name} -&gt; CTAO theta2_png" name="out_CTAO_theta2_png" format="auto" from_work_dir="theta2_png_galaxy.output">
      <filter>_data_product['_selector'] == 'CTAO'</filter>
    </data>
    <data label="${tool.name} -&gt; CTAO spectrum_png" name="out_CTAO_spectrum_png" format="auto" from_work_dir="spectrum_png_galaxy.output">
      <filter>_data_product['_selector'] == 'CTAO'</filter>
    </data>
    <data label="${tool.name} -&gt; CTAO event_list_fits" name="out_CTAO_event_list_fits" format="auto" from_work_dir="event_list_fits_galaxy.output">
      <filter>_data_product['_selector'] == 'CTAO'</filter>
    </data>
    <data label="${tool.name} -&gt; MAGIC_simulator-v1.9 spectrum_png" name="out_MAGIC_simulator_v1.9_spectrum_png" format="auto" from_work_dir="spectrum_png_galaxy.output">
      <filter>_data_product['_selector'] == 'MAGIC_simulator-v1.9'</filter>
    </data>
    <data label="${tool.name} -&gt; MAGIC_simulator-v1.9 spectrum_table" name="out_MAGIC_simulator_v1.9_spectrum_table" format="auto" from_work_dir="spectrum_table_galaxy.output">
      <filter>_data_product['_selector'] == 'MAGIC_simulator-v1.9'</filter>
    </data>
    <data label="${tool.name} -&gt; LST1_spectrum SED" name="out_LST1_spectrum_SED" format="auto" from_work_dir="SED_galaxy.output">
      <filter>_data_product['_selector'] == 'LST1_spectrum'</filter>
    </data>
    <data label="${tool.name} -&gt; LST1_spectrum Count_spectrum" name="out_LST1_spectrum_Count_spectrum" format="auto" from_work_dir="Count_spectrum_galaxy.output">
      <filter>_data_product['_selector'] == 'LST1_spectrum'</filter>
    </data>
    <data label="${tool.name} -&gt; LST1_spectrum Etrue_vs_Ereco" name="out_LST1_spectrum_Etrue_vs_Ereco" format="auto" from_work_dir="Etrue_vs_Ereco_galaxy.output">
      <filter>_data_product['_selector'] == 'LST1_spectrum'</filter>
    </data>
    <data label="${tool.name} -&gt; LST1_spectrum Significance" name="out_LST1_spectrum_Significance" format="auto" from_work_dir="Significance_galaxy.output">
      <filter>_data_product['_selector'] == 'LST1_spectrum'</filter>
    </data>
    <data label="${tool.name} -&gt; LST1_spectrum SED_astropy_table" name="out_LST1_spectrum_SED_astropy_table" format="auto" from_work_dir="SED_astropy_table_galaxy.output">
      <filter>_data_product['_selector'] == 'LST1_spectrum'</filter>
    </data>
    <data label="${tool.name} -&gt; LST1_spectrum Count_spectrum_astropy_table" name="out_LST1_spectrum_Count_spectrum_astropy_table" format="auto" from_work_dir="Count_spectrum_astropy_table_galaxy.output">
      <filter>_data_product['_selector'] == 'LST1_spectrum'</filter>
    </data>
    <data label="${tool.name} -&gt; Visibility_predictor GTI_png" name="out_Visibility_predictor_GTI_png" format="auto" from_work_dir="GTI_png_galaxy.output">
      <filter>_data_product['_selector'] == 'Visibility_predictor'</filter>
    </data>
    <data label="${tool.name} -&gt; Visibility_predictor GTI_table" name="out_Visibility_predictor_GTI_table" format="auto" from_work_dir="GTI_table_galaxy.output">
      <filter>_data_product['_selector'] == 'Visibility_predictor'</filter>
    </data>
  </outputs>
  <tests>
    <test expect_num_outputs="4">
      <conditional name="_data_product">
        <param name="_selector" value="CTAO" />
        <param name="RA" value="166.113809" />
        <param name="DEC" value="38.208833" />
        <param name="OffAxis_angle" value="0.78" />
        <param name="Texp" value="1.0" />
        <param name="z" value="0.03" />
        <param name="F0" value="1e-11" />
        <param name="E0" value="1.0" />
        <param name="Gamma" value="2.0" />
        <param name="Radius_spectal_extraction" value="0.2" />
        <param name="Radius_sky_image" value="2.5" />
        <param name="Site" value="North" />
        <param name="Telescope_LST" value="True" />
        <param name="Telescope_MST" value="True" />
        <param name="Telescope_SST" value="False" />
      </conditional>
      <assert_stdout>
        <has_text text="*** Job finished successfully ***" />
      </assert_stdout>
    </test>
    <test expect_num_outputs="2">
      <conditional name="_data_product">
        <param name="_selector" value="MAGIC_simulator-v1.9" />
        <param name="src_name" value="Crab" />
        <param name="RA" value="83.6287" />
        <param name="DEC" value="22.0147" />
        <param name="timeh" value="20" />
        <param name="extension" value="0.0" />
        <param name="redshift" value="0.13" />
        <param name="zenith" value="lowzd" />
        <param name="isSUMT" value="False" />
        <param name="numoff" value="3" />
        <param name="minev" value="10.0" />
        <param name="minSBR" value="0.05" />
        <param name="PSF" value="0.1" />
        <param name="offsetdegrad" value="1.0" />
        <param name="eplotmin" value="31" />
        <param name="eplotmax" value="20000.0" />
        <param name="yplotmin" value="1e-14" />
        <param name="yplotmax" value="1e-09" />
        <param name="minerror" value="2" />
        <param name="drawsigma" value="True" />
        <param name="dN_dE" value="2.0e-11*pow(E/1000., -1.99)*exp(-E/1000)" />
        <param name="pulsar_mode" value="False" />
        <param name="on_phase_interval" value="0.092" />
        <param name="off_phase_interval" value="0.25" />
        <param name="isLSTmode" value="False" />
      </conditional>
      <assert_stdout>
        <has_text text="*** Job finished successfully ***" />
      </assert_stdout>
    </test>
    <test expect_num_outputs="6">
      <conditional name="_data_product">
        <param name="_selector" value="LST1_spectrum" />
        <param name="src_name" value="Mrk 421" />
        <param name="RA" value="166.113809" />
        <param name="DEC" value="38.208833" />
        <param name="T1" value="2022-10-09T13:16:00.0" />
        <param name="T2" value="2022-10-10T13:16:00.0" />
        <param name="redshift" value="0.13" />
        <param name="cut_efficiency" value="0.7" />
        <param name="Zd" value="20.0" />
        <param name="N_backgr_regions" value="3" />
        <param name="Exposure_time" value="33.0" />
        <param name="source_extension" value="0.1" />
        <param name="dN_dE" value="2.0e-11*pow(E/1000., -1.99)*exp(-E/1000)" />
        <param name="pulsar_mode" value="False" />
        <param name="on_phase_interval" value="0.043" />
        <param name="off_phase_interval" value="0.35" />
      </conditional>
      <assert_stdout>
        <has_text text="*** Job finished successfully ***" />
      </assert_stdout>
    </test>
    <test expect_num_outputs="2">
      <conditional name="_data_product">
        <param name="_selector" value="Visibility_predictor" />
        <param name="src_name" value="Crab" />
        <param name="RA" value="83.6287" />
        <param name="DEC" value="22.0147" />
        <param name="T1" value="2023-10-09T13:16:00.0" />
        <param name="T2" value="2024-10-10T13:16:00.0" />
        <param name="Zdmin" value="0" />
        <param name="Zdmax" value="30" />
        <param name="moon_max" value="0.1" />
      </conditional>
      <assert_stdout>
        <has_text text="*** Job finished successfully ***" />
      </assert_stdout>
    </test>
  </tests>
  <environment_variables>
    <environment_variable name="BASEDIR">$__tool_directory__</environment_variable>
    <environment_variable name="GALAXY_TOOL_DIR">$__tool_directory__</environment_variable>
  </environment_variables>
  <help>Dummy tool help text.
</help>
</tool>